var addonConfig={engines:chrome.i18n.getMessage("defaultEnginesConfig"),select2clipboard:!1,showTooltip:!1,showTopSearchSwitch:!0,searchInNewTab:!0,themeStyle:"icon",themeColor:"rgba(144, 238, 144, 0.56)",textColor:"#202124"},selectTxt="",lasturl=window.location.href;function isHashChanged(){var o=window.location.href;return lasturl!=o&&(lasturl=o,!0)}function hashChange(){var o=document.getElementById("addon_toptooltip");o&&o.remove(),createTopTooltip()}function getSelectText(){var o="";return o=document.selection?document.selection.createRange().text:document.getSelection(),o.toString().trim()}function removeTooltip(){var o=document.getElementById("addon_tooltip");o&&o.remove()}function copySelectTxt(){navigator.clipboard.writeText(selectTxt).then((()=>{})).catch((o=>{console.log(`Copy failed! ${o}`)}))}function createTooltip(o){var e=o.pageX,n=o.pageY,t=`<div id="strong_search_menu_id" class="addon_xlj_toobar" style="position: absolute; left: {x}px; top: {y}px; z-index: 100000000; background-color: ${addonConfig.themeColor}; color: ${addonConfig.textColor};">`,a=/(\w+[^\s]+(\.[^\s]+){1,})/,d=a.exec(selectTxt);if(d){var i=d[1].trim(),l=chrome.i18n.getMessage("open"),c=`<a class="addon_xlj_copy_toobar addon_xlj_button" style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${i}">\n        <img class="addon_xlj_search_icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUxNTgwNDU1NTcwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijk0MiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSI5NDMiPjwvcGF0aD48cGF0aCBkPSJNNzY4IDgzMkgxOTJWMjU2aDM1MnYtNjRIMTYwYTMyIDMyIDAgMCAwLTMyIDMydjY0MGEzMiAzMiAwIDAgMCAzMiAzMmg2NDBhMzIgMzIgMCAwIDAgMzItMzJWNDgwaC02NHYzNTJ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSI5NDQiPjwvcGF0aD48L3N2Zz4=">\n        <div class="addon_xlj_func">${l}</div></a>`;t+=c}var r=chrome.i18n.getMessage("copy");if(!addonConfig.select2clipboard){let o="ðŸ“‹";c=`<div class="addon_xlj_copy_toobar addon_xlj_button" style="font-size:20px;line-height:22px;cursor:pointer;color:${addonConfig.textColor};" title="${r}" onclick="navigator.clipboard.writeText('${selectTxt}')">\n        ${o}\n      </div>`,t+=c}var s='<div class="addon_xlj_button">',g=0;if(addonConfig.engines.forEach((o=>{if(o.name&&o.url&&o.inTooltip){g+=1;var e=o.url.replace("%s",encodeURIComponent(selectTxt));if("text"==addonConfig.themeStyle||!o.icon&&!o.iconData)s+=`<div class="addon_xlj_search_parts_engine addon_xlj_link_color" data-url="${e}" title="${o.name}"><a style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${e}">${o.name}</a></div>`;else{var n=o.iconData||o.icon;s+=`<a class="addon_xlj_search_parts_engine" style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${e}"><img style="width: 22px; height: 22px;" src="${n}" alt="${o.name}"></a>`}}})),s+="</div>",g>0&&(t+=s),0!=g||!addonConfig.select2clipboard){t+="</div>",t=t.replace("{x}",e+5).replace("{y}",n+20);var f=document.createElement("div");f.id="addon_tooltip",f.innerHTML=t,document.body.appendChild(f)}}function createTopTooltip(){console.log("createTopTooltip");var o=`<div id="strong_search_menu_id" class="addon_xlj_toobar" style="position: fixed; left: 60%; top: 0px; z-index: 100000000; background-color: ${addonConfig.themeColor}; color: ${addonConfig.textColor};">`,e=0,n='<div class="addon_xlj_button">';"black"!=addonConfig.themeColor&&(n='<div style="border-right: 0px;" class="addon_xlj_button">');var t=parseUrl(window.location.href),a=t["wd"]||t["word"]||t["query"]||t["q"]||t["w"]||"";if(a=decodeURI(a),a&&(addonConfig.engines.forEach((o=>{if(o.name&&o.url&&o.inPopup){e+=1;var t=o.url.replace("%s",a);if("text"==addonConfig.themeStyle||!o.icon&&!o.iconData)n+=`<div class="addon_xlj_search_parts_engine addon_xlj_link_color" data-url="${t}" title="${o.name}"><a style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${t}">${o.name}</a></div>`;else{var d=o.iconData||o.icon;n+=`<a class="addon_xlj_search_parts_engine" style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${t}"><img style="width: 22px; height: 22px;" src="${d}" alt="${o.name}"></a>`}}})),n+="</div>",!(e<=0))){o+=n,"black"!=addonConfig.themeColor?o+=`<div class="addon_xlj_copy_toobar addon_xlj_button" title="close" style="color:${addonConfig.textColor};" onclick="document.getElementById('addon_toptooltip').remove()">\n        <div class="addon_xlj_func">X</div></div>`:o+=`<div class="addon_xlj_copy_toobar addon_xlj_button" title="close" style="color:${addonConfig.textColor};" onclick="document.getElementById('addon_toptooltip').remove()">\n        <div class="addon_xlj_func addon_xlj_link_color">X</div></div>`,o+="</div>";var d=document.createElement("div");d.id="addon_toptooltip",d.innerHTML=o,document.body.appendChild(d)}}function parseUrl(o){var e={},n=/([^?=&]+)=([^?=&]+)/g;return o.replace(n,(function(){e[arguments[1]]=arguments[2]})),e}chrome.storage.sync.get(addonConfig,(function(o){addonConfig.engines=JSON.parse(o.engines),chrome.storage.local.get(null,(function(e){if(addonConfig.engines.forEach((o=>{e&&e["iconData_"+o.id]&&(o.icon=e["iconData_"+o.id])})),addonConfig.select2clipboard=o.select2clipboard,addonConfig.showTooltip=o.showTooltip,addonConfig.showTopSearchSwitch=o.showTopSearchSwitch,addonConfig.searchInNewTab=o.searchInNewTab,addonConfig.themeColor=o.themeColor,addonConfig.textColor=o.textColor||"#202124",addonConfig.showTopSearchSwitch){var n=document.domain.split("."),t=!1;if(n.length>=2){var a=n[1];2!=n.length&&"com"!=a||(a=n[0]),addonConfig.engines.forEach((o=>{o.url&&o.inPopup&&-1!=o.url.indexOf(a)&&(t=!0)})),"baidu"!=a&&"google"!=a||setInterval((function(){var o=isHashChanged();o&&hashChange()}),3e3)}t&&createTopTooltip()}return!0}))})),document.addEventListener("mouseup",(function(o){selectTxt=getSelectText(),addonConfig.select2clipboard&&copySelectTxt(),setTimeout((function(){removeTooltip(),addonConfig.showTooltip&&selectTxt&&createTooltip(o)}),100)}));