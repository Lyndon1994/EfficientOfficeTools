var addonConfig={engines:chrome.i18n.getMessage("defaultEnginesConfig"),select2clipboard:!1,showTooltip:!1,showTopSearchSwitch:!0,searchInNewTab:!0,themeStyle:"icon",themeColor:"rgba(144, 238, 144, 0.56)",textColor:"#202124"},selectTxt="",lasturl=window.location.href;function isHashChanged(){var e=window.location.href;return lasturl!=e&&(lasturl=e,!0)}function hashChange(){var e=document.getElementById("addon_toptooltip");e&&e.remove(),createTopTooltip()}function getSelectText(){var e="";return e=document.selection?document.selection.createRange().text:document.getSelection(),e.toString().trim()}function removeTooltip(){var e=document.getElementById("addon_tooltip");e&&e.remove()}function copySelectTxt(){navigator.clipboard.writeText(selectTxt).then((()=>{})).catch((e=>{console.log(`Copy failed! ${e}`)}))}function createTooltip(e){var o=e.pageX,n=e.pageY,t=`<div id="strong_search_menu_id" class="addon_xlj_toobar"style="position: absolute; left: {x}px; top: {y}px; z-index: 100000000;background-color: ${addonConfig.themeColor}">`,a=/(\w+[^\s]+(\.[^\s]+){1,})/,d=a.exec(selectTxt);if(d){var i=d[1].trim(),l=chrome.i18n.getMessage("open"),c=`<a class="addon_xlj_copy_toobar addon_xlj_button" style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${i}">\n        <img class="addon_xlj_search_icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUxNTgwNDU1NTcwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijk0MiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSI5NDMiPjwvcGF0aD48cGF0aCBkPSJNNzY4IDgzMkgxOTJWMjU2aDM1MnYtNjRIMTYwYTMyIDMyIDAgMCAwLTMyIDMydjY0MGEzMiAzMiAwIDAgMCAzMiAzMmg2NDBhMzIgMzIgMCAwIDAgMzItMzJWNDgwaC02NHYzNTJ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSI5NDQiPjwvcGF0aD48L3N2Zz4=">\n        <div class="addon_xlj_func">${l}</div></a>`;t+=c}var r=chrome.i18n.getMessage("copy");if(!addonConfig.select2clipboard){let e="ðŸ“‹";c=`<div class="addon_xlj_copy_toobar addon_xlj_button" style="font-size:20px;line-height:22px;cursor:pointer;" title="${r}" onclick="navigator.clipboard.writeText('${selectTxt}')">\n        ${e}\n      </div>`,t+=c}var s='<div class="addon_xlj_button">',g=0;if(addonConfig.engines.forEach((e=>{if(e.name&&e.url&&e.inTooltip){g+=1;var o=e.url.replace("%s",encodeURIComponent(selectTxt));if("text"==addonConfig.themeStyle)s+=`<div class="addon_xlj_search_parts_engine addon_xlj_link_color" data-url="${o}" title="${e.name}"><a style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${o}">${e.name}</a></div>`;else{var n=chrome.runtime.getURL(e.icon);-1!==e.icon.indexOf("http")&&(n=e.icon),s+=`<a class="addon_xlj_search_parts_engine style="color:beige;" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${o}"><img style="width: 22px; height: 22px;" src="${n}" alt="${e.name}"></a>`}}})),s+="</div>",g>0&&(t+=s),0!=g||!addonConfig.select2clipboard){t+="</div>",t=t.replace("{x}",o+5).replace("{y}",n+20);var p=document.createElement("div");p.id="addon_tooltip",p.innerHTML=t,document.body.appendChild(p)}}function createTopTooltip(){console.log("createTopTooltip");var e=`<div id="strong_search_menu_id" class="addon_xlj_toobar" style="position: fixed; left: 60%; top: 0px; z-index: 100000000;background-color: ${addonConfig.themeColor}">`,o=0,n='<div class="addon_xlj_button">';"black"!=addonConfig.themeColor&&(n='<div style="border-right: 0px;" class="addon_xlj_button">');var t=parseUrl(window.location.href),a=t["wd"]||t["word"]||t["query"]||t["q"]||t["w"]||"";if(a=decodeURI(a),a&&(addonConfig.engines.forEach((e=>{if(e.name&&e.url&&e.inPopup){o+=1;var t=e.url.replace("%s",a);if("text"==addonConfig.themeStyle)n+=`<div class="addon_xlj_search_parts_engine addon_xlj_link_color" data-url="${t}" title="${e.name}"><a style="color:${addonConfig.textColor};" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${t}">${e.name}</a></div>`;else{var d=chrome.runtime.getURL(e.icon);-1!==e.icon.indexOf("http")&&(d=e.icon),n+=`<a class="addon_xlj_search_parts_engine style="color:beige;" target="${addonConfig.searchInNewTab?"_blank":"_self"}" href="${t}"><img style="width: 22px; height: 22px;" src="${d}" alt="${e.name}"></a>`}}})),n+="</div>",!(o<=0))){e+=n,"black"!=addonConfig.themeColor?e+='<div class="addon_xlj_copy_toobar addon_xlj_button"title="close" onclick="document.getElementById(\'addon_toptooltip\').remove()">\n        <div class="addon_xlj_func">X</div></div>':e+='<div class="addon_xlj_copy_toobar addon_xlj_button"title="close" onclick="document.getElementById(\'addon_toptooltip\').remove()">\n        <div class="addon_xlj_func addon_xlj_link_color">X</div></div>',e+="</div>";var d=document.createElement("div");d.id="addon_toptooltip",d.innerHTML=e,document.body.appendChild(d)}}function parseUrl(e){var o={},n=/([^?=&]+)=([^?=&]+)/g;return e.replace(n,(function(){o[arguments[1]]=arguments[2]})),o}chrome.storage.sync.get(addonConfig,(function(e){if(addonConfig.engines=JSON.parse(e.engines),addonConfig.select2clipboard=e.select2clipboard,addonConfig.showTooltip=e.showTooltip,addonConfig.showTopSearchSwitch=e.showTopSearchSwitch,addonConfig.searchInNewTab=e.searchInNewTab,addonConfig.themeColor=e.themeColor,addonConfig.showTopSearchSwitch){var o=document.domain.split("."),n=!1;if(o.length>=2){var t=o[1];2!=o.length&&"com"!=t||(t=o[0]),addonConfig.engines.forEach((e=>{e.url&&e.inPopup&&-1!=e.url.indexOf(t)&&(n=!0)})),"baidu"!=t&&"google"!=t||setInterval((function(){var e=isHashChanged();e&&hashChange()}),3e3)}n&&createTopTooltip()}return!0})),document.addEventListener("mouseup",(function(e){selectTxt=getSelectText(),addonConfig.select2clipboard&&copySelectTxt(),setTimeout((function(){removeTooltip(),addonConfig.showTooltip&&selectTxt&&createTooltip(e)}),100)}));