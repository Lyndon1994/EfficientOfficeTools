(function(){"use strict";var e={5643:function(e,t,i){var s=i(3751),o=i(7975),n=(i(4188),i(641)),l=i(33);const r=["innerHTML"],a=["src"],u={key:1},g={key:0,class:"history-days-area"},c={style:{"text-align":"right",margin:"0"}};function h(e,t,i,o,h,p){const d=(0,n.g2)("el-autocomplete"),y=(0,n.g2)("el-row"),f=(0,n.g2)("el-tag"),m=(0,n.g2)("el-slider"),b=(0,n.g2)("el-tooltip"),w=(0,n.g2)("el-button"),x=(0,n.g2)("el-popover"),v=(0,n.g2)("el-form");return(0,n.uX)(),(0,n.Wv)(v,{style:(0,l.Tr)(p.tableheightWithPadding),ref:"form","label-width":"10px",size:"mini",onSubmit:t[5]||(t[5]=(0,s.D$)((()=>{}),["prevent"]))},{default:(0,n.k6)((()=>[(0,n.bF)(y,{style:{width:"inherit"}},{default:(0,n.k6)((()=>[(0,n.bF)(d,{ref:"queryInput",style:{width:"inherit"},class:"inline-input",modelValue:h.query,"onUpdate:modelValue":t[0]||(t[0]=e=>h.query=e),onFocus:p.handleFocus,"fetch-suggestions":p.querySearch,placeholder:"Search ...","trigger-on-focus":!1,"popper-append-to-body":!1,"highlight-first-item":h.highlightFirstItem,onSelect:p.handleSelect,onKeyup:(0,s.jR)(p.onSubmit,["enter"]),onBlur:p.handleBlur,onInput:p.handleQueryInput},{default:(0,n.k6)((({item:e})=>[(0,n.Lk)("span",{innerHTML:e.value},null,8,r)])),_:1},8,["modelValue","onFocus","fetch-suggestions","highlight-first-item","onSelect","onKeyup","onBlur","onInput"])])),_:1}),(0,n.bF)(y,{ref:"engineRow",style:(0,l.Tr)(p.computedEngineRowStyle),class:(0,l.C4)({"engine-row-fixed-bottom":h.enginesFixedBottom})},{default:(0,n.k6)((()=>[(0,n.Lk)("div",{class:(0,l.C4)(["engine-options-area",{"full-width":!h.showHistoryDaysTooltip}])},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(h.engines,(e=>((0,n.uX)(),(0,n.Wv)(f,{key:e.id,type:e.id-1==h.selectId?"success":"info",hit:e.id-1==h.selectId,color:e.id-1==h.selectId?"":"Transparent",onClick:t=>p.search(e),onMouseenter:t=>p.selectSearch(e),style:{"margin-right":"4px","margin-bottom":"10px"}},{default:(0,n.k6)((()=>[e.icon||e.iconData?((0,n.uX)(),(0,n.CE)("img",{key:0,style:{width:"30px",height:"30px"},src:e.iconData||e.icon},null,8,a)):(0,n.Q3)("",!0),e.icon||e.iconData?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("span",u,(0,l.v_)(e.name),1))])),_:2},1032,["type","hit","color","onClick","onMouseenter"])))),128))],2),h.showHistoryDaysTooltip?((0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(b,{class:"item",effect:"light",disabled:h.disabledHistoryTooltip,content:p.getMessage("historyDaysTip"),placement:"top"},{default:(0,n.k6)((()=>[(0,n.bF)(m,{"input-size":e.mini,modelValue:h.historyDays,"onUpdate:modelValue":t[1]||(t[1]=e=>h.historyDays=e),max:365,onChange:p.onChangeHistoryDays},null,8,["input-size","modelValue","onChange"])])),_:1},8,["disabled","content"])])):(0,n.Q3)("",!0),(0,n.Lk)("i",{class:"el-icon-setting",onClick:t[2]||(t[2]=e=>p.setting()),style:{cursor:"pointer",position:"absolute",top:"15px",right:"1px",opacity:"0.2"}}),(0,n.bF)(x,{trigger:"manual",placement:"bottom",width:"160",modelValue:h.first,"onUpdate:modelValue":t[4]||(t[4]=e=>h.first=e)},{default:(0,n.k6)((()=>[(0,n.Lk)("p",null,(0,l.v_)(p.getMessage("tabTip")),1),(0,n.Lk)("div",c,[(0,n.bF)(w,{size:"mini",type:"text",onClick:t[3]||(t[3]=e=>p.setFirst())},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(p.getMessage("dontTip")),1)])),_:1})])])),_:1},8,["modelValue"])])),_:1},8,["style","class"])])),_:1},8,["style"])}i(8111),i(2489),i(531),i(7588),i(1701);const p="63px",d="300px",y="700px";var f={name:"App",components:{},data(){return{tableheight:{height:p,width:d},engines:[],query:"",selectId:0,tabIndex:-1,first:!1,searchInNewTab:!0,queryMatchHistory:[],historyDays:90,showHistoryDaysTooltip:!1,disabledHistoryTooltip:!1,preHeight:p,highlightFirstItem:!1,popupSuggestEnabled:!0,popupSuggestEngine:"bing",popupHistoryEnabled:!0,popupHistoryDays:90,enginesFixedBottom:!1,engineRowLines:1,suggestionsVisible:!1,suggestionBoxHeight:0}},methods:{init(){let e={engines:chrome.i18n.getMessage("defaultEnginesConfig"),first:!0,selectId:0,searchInNewTab:!0,popupSuggestEnabled:!0,popupSuggestEngine:"bing",popupHistoryEnabled:!0,popupHistoryDays:90},t=this;console.log("[popup] init defaultConfig:",e),chrome.storage.sync.get(e,(function(e){let i;console.log("[popup] chrome.storage.sync.get result:",e);try{i=JSON.parse(e.engines)}catch(s){console.error("[popup] Failed to parse engines from storage:",e.engines,s),i=[]}chrome.storage.local.get(null,(function(s){let o=0;t.engines=i.filter((e=>{if(e.name&&e.url&&!0===e.inPopup){let t;return o++,e.id=o,e.icon&&(t=s["iconData_"+e.icon]),!t&&e.name&&(t=s["iconData_"+e.name]),t&&(e.iconData=t),e}})),t.first=e.first,t.selectId=e.selectId,t.searchInNewTab=e.searchInNewTab,t.popupSuggestEnabled=e.popupSuggestEnabled,t.popupSuggestEngine=e.popupSuggestEngine,t.popupHistoryEnabled=e.popupHistoryEnabled,t.popupHistoryDays=e.popupHistoryDays,t.historyDays=t.popupHistoryDays,console.log("[popup] loaded engines:",t.engines),console.log("[popup] loaded first:",t.first),console.log("[popup] get with selectId",t.selectId),t.selectId>=t.engines.length&&(t.selectId=0,console.log("[popup] change selectId to",t.selectId))}))})),chrome.tabs.query({active:!0},(function(e){let i=e[0],s=m(i.url);t.query=s["wd"]||s["word"]||s["q"]||s["query"]||s["w"]||"",t.query=decodeURI(t.query),t.tabIndex=i.index,console.log("[popup] tab info:",i,"parsed query:",t.query)})),this.$nextTick((()=>{this.$refs["queryInput"].focus()}))},getMessage(e){return chrome.i18n.getMessage(e)},search(e,t=!1){chrome.storage.sync.set({selectId:this.selectId}),this.searchInNewTab&&(t=!t),this.query=this.query.trim(),this.query&&!t?(chrome.tabs.update({url:e.url.replace("%s",this.query)}),window.close()):this.query&&(chrome.tabs.create({url:e.url.replace("%s",this.query),index:this.tabIndex+1}),window.close())},selectSearch(e){this.selectId=e.id-1},onSubmit(){this.searchFirst(!1)},searchFirst(e=!1){this.search(this.engines[this.selectId],e)},changeSelectId(){this.selectId=(this.selectId+1)%this.engines.length},onKeyDown(e){return 9==e.keyCode&&(document.getElementsByClassName("el-autocomplete-suggestion")&&(document.getElementsByClassName("el-autocomplete-suggestion")[0].style.display="block"),e.preventDefault(),this.changeSelectId(),!1)},setting(){var e=chrome.runtime.getURL("options.html");chrome.tabs.create({url:e})},setFirst(){this.first=!1,chrome.storage.sync.set({first:!1})},unique(e,t){const i=new Map;return e.filter((e=>!i.has(e[t])&&i.set(e[t],1)))},getHeight(e){return 0==e?63:1==e?132:Math.min(360,90+34*e)},googleSuggest(e,t){let i=this;this.highlightFirstItem=!1;try{this.$axios.get(`https://suggestqueries.google.com/complete/search?client=youtube&q=${e}&jsonp=window.google.ac.h`).then((function(e){if(200==e.status){let s=JSON.parse(e.data.replace(/window.google.ac.h\((.*)\)/,"$1")),o=Array.isArray(s[1])?s[1].map((e=>({value:e[0]}))):[];const n=i.queryMatchHistory.filter((e=>e.pin)).concat(i.queryMatchHistory.filter((e=>e.visitCount&&e.visitCount>=3))).slice(0,1),l=n.map((e=>e.url));n.length>0&&(i.highlightFirstItem=!0);const r=i.queryMatchHistory.filter((e=>!l.includes(e.url)));o=n.concat(o.slice(0,5)).concat(r).concat(o.slice(5)),i.tableheight.height=i.getHeight(o.length)+"px",t(o)}}),(function(){console.log("request suggestqueries.google.com failed")}))}catch(s){console.log(s)}},bingSuggest(e,t){let i=this;this.highlightFirstItem=!1;try{this.$axios.get(`https://api.bing.com/qsonhs.aspx?type=cb&q=${e}&cb=window.bing.sug`).then((function(e){if(200==e.status){let s=JSON.parse(e.data.replace(/.*window.bing.sug\((.*)\/\* pageview_candidate \*\/\)\;/,"$1"));if(s["AS"]["FullResults"]<=0)return;let o=s.AS.Results.flatMap((e=>e.Suggests.map((e=>({value:e.Txt})))));const n=i.queryMatchHistory.filter((e=>e.pin)).concat(i.queryMatchHistory.filter((e=>e.visitCount&&e.visitCount>=3))).slice(0,1),l=n.map((e=>e.url));n&&(i.highlightFirstItem=!0);const r=i.queryMatchHistory.filter((e=>!l.includes(e.url)));o=n.concat(o.slice(0,5)).concat(r).concat(o.slice(5)),i.tableheight.height=i.getHeight(o.length)+"px",t(o)}}),(function(){console.log("request api.bing.com failed")}))}catch(s){console.log(s)}},querySearch(e,t){this.popupSuggestEnabled||this.popupHistoryEnabled?(this.suggestionsVisible=!0,this.queryMatch(e,(e=>{e&&e.length>0?this.suggestionBoxHeight=Math.min(300,34*e.length):this.suggestionBoxHeight=0,t(e)}))):(this.suggestionsVisible=!1,console.log("no suggestion"),t([]))},queryMatch(e,t){let i=this,s=[];if(this.queryMatchHistory=[],console.log("query match start: "+e+" history days: "+this.historyDays),this.popupSuggestEnabled?(this.tableheight.width=y,this.enginesFixedBottom=!0,"bing"===this.popupSuggestEngine?this.bingSuggest(e,t):"google"===this.popupSuggestEngine&&this.googleSuggest(e,t)):this.enginesFixedBottom=!1,!this.popupHistoryEnabled)return void(this.enginesFixedBottom=!1);this.tableheight.width=y,this.enginesFixedBottom=!0,this.showHistoryDaysTooltip=!0,chrome.bookmarks.search(e,(function(e){s=e.filter((e=>null!=e["url"])).slice(0,10)}));let o=e.match(/^[^-]+/),n=e.match(/(?<=-)\w+/g);e=o?o[0]:e,chrome.history.search({text:e,maxResults:30,startTime:(new Date).getTime()-864e5*i.historyDays},(function(o){console.log("bookmarks"),console.log(s),console.log("history:"),console.log(o),o=i.unique(s.concat(o),"url"),o.forEach((t=>{let i=t["url"].replace(/^https?:\/\/(www\.)?/,"");t["value"]=`${t["title"]} - <span style="color:blue;">${i}</span>`,t.dateAdded&&(t["value"]=`⭐️${t["value"]}`),e.split(/[\s\+]+/).forEach((e=>{e=e.trim(),e&&(t["value"]=t["value"].replaceAll(e,`<b>${e}</b>`))}));let s=new URL(t["url"]).hostname;t.visitCount&&0===s.indexOf(e)&&(t["pin"]=!0),-1!=t["url"].indexOf("http")&&(t["value"]=`<img src="https://icon.horse/icon/${s}" style="width: 18px; vertical-align: middle;"> ${t["value"]}`)})),n&&n.length>0&&n.forEach((e=>{e=e.trim().toLowerCase(),e&&(o=o.filter((t=>-1==t["url"].toLowerCase().indexOf(e)&&-1==t["title"].toLowerCase().indexOf(e))))})),i.queryMatchHistory=o,i.tableheight.height=i.getHeight(o.length)+"px",t(o)}))},handleSelect(e){console.log(e),e.url?this.searchInNewTab?(chrome.tabs.create({url:e.url,index:this.tabIndex+1}),window.close()):(chrome.tabs.update({url:e.url}),window.close()):this.searchFirst()},handleBlur(e){console.log("blur")},handleFocus(e){console.log("focus"),e.target.select()},handleQueryInput(){this.$nextTick((()=>{const e=document.querySelector(".el-autocomplete-suggestion");e&&(this.suggestionsVisible="none"!==e.style.display,this.updateEngineRowLines())}))},onChangeHistoryDays(){this.disabledHistoryTooltip=!0,document.getElementsByClassName("el-autocomplete-suggestion")&&(document.getElementsByClassName("el-autocomplete-suggestion")[0].style.display="block")},updateEngineRowLines(){this.$nextTick((()=>{const e=this.$refs.engineRow;if(e){const t=e.offsetHeight||1,i=38;if(this.engineRowLines=Math.max(1,Math.round(t/i)),this.suggestionsVisible&&this.enginesFixedBottom){const e=document.querySelector(".el-autocomplete-suggestion");e&&(this.suggestionBoxHeight=e.offsetHeight||0)}}}))}},created(){this.init(),window.addEventListener("keydown",this.onKeyDown)},beforeDestroy(){window.removeEventListener("keydown",this.onKeyDown)},computed:{tableheightWithPadding(){if(!this.enginesFixedBottom)return this.tableheight;const e=38*this.engineRowLines+16;return{...this.tableheight,paddingBottom:`${e}px`}},computedEngineRowStyle(){const e={marginTop:"12px",display:"flex",flexWrap:"wrap",alignItems:"center"};return this.enginesFixedBottom?this.suggestionsVisible&&this.suggestionBoxHeight>0?{...e,position:"absolute",left:0,bottom:0,width:"100%",zIndex:200}:e:{...e,width:"inherit",position:"relative",zIndex:100}},historyDaysTooltipStyle(){return this.enginesFixedBottom?this.suggestionsVisible?{position:"absolute",right:"40px",bottom:38*this.engineRowLines+8+"px",zIndex:300,background:"#fff",padding:"4px 0"}:{position:"fixed",right:"40px",bottom:38*this.engineRowLines+56+"px",zIndex:300,background:"#fff",padding:"4px 0"}:{position:"absolute",right:"40px",top:"0px"}}},watch:{query:function(e){""==e?(this.tableheight.height=p,this.suggestionsVisible=!1):this.$nextTick((()=>{const e=document.querySelector(".el-autocomplete-suggestion");e&&(this.suggestionsVisible="none"!==e.style.display)}))},engines(){this.updateEngineRowLines()},enginesFixedBottom(){this.updateEngineRowLines()},suggestionsVisible(){this.updateEngineRowLines()}},mounted(){this.updateEngineRowLines()},updated(){this.updateEngineRowLines()}};function m(e){let t={},i=/([^?=&]+)=([^?=&]+)/g;return e=e.replace(/#.*/,""),e.replace(i,(function(){t[arguments[1]]=arguments[2]})),t}var b=i(6262);const w=(0,b.A)(f,[["render",h]]);var x=w,v=i(7906);const I=(0,s.Ef)(x);I.use(o.A),I.config.globalProperties.$axios=v.A,I.mount("#app")}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}i.m=e,function(){var e=[];i.O=function(t,s,o,n){if(!s){var l=1/0;for(g=0;g<e.length;g++){s=e[g][0],o=e[g][1],n=e[g][2];for(var r=!0,a=0;a<s.length;a++)(!1&n||l>=n)&&Object.keys(i.O).every((function(e){return i.O[e](s[a])}))?s.splice(a--,1):(r=!1,n<l&&(l=n));if(r){e.splice(g--,1);var u=o();void 0!==u&&(t=u)}}return t}n=n||0;for(var g=e.length;g>0&&e[g-1][2]>n;g--)e[g]=e[g-1];e[g]=[s,o,n]}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.j=887}(),function(){var e={887:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,n,l=s[0],r=s[1],a=s[2],u=0;if(l.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(a)var g=a(i)}for(t&&t(s);u<l.length;u++)n=l[u],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(g)},s=self["webpackChunksearch_tool"]=self["webpackChunksearch_tool"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[504],(function(){return i(5643)}));s=i.O(s)})();