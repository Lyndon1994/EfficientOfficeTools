(function(e){function t(t){for(var i,r,a=t[0],c=t[1],l=t[2],h=0,g=[];h<a.length;h++)r=a[h],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&g.push(o[r][0]),o[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(g.length)g.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(i=!1)}i&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},o={popup:0},s=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("aa9d")},aa9d:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("2b0e"),o=n("5c96"),s=n.n(o),r=(n("0fae"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"form",style:e.tableheight,attrs:{"label-width":"10px",size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-row",{staticStyle:{width:"inherit"}},[n("el-autocomplete",{ref:"queryInput",staticClass:"inline-input",staticStyle:{width:"inherit"},attrs:{size:"small","fetch-suggestions":e.queryMatch,placeholder:"Search ...","trigger-on-focus":!1,"popper-append-to-body":!1,"highlight-first-item":e.highlightFirstItem},on:{focus:e.handleFocus,select:e.handleSelect,blur:e.handleBlur},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSubmit(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("span",{domProps:{innerHTML:e._s(i.value)}},[e._v(e._s(i.value))])]}}]),model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1),n("el-row",{staticStyle:{position:"fixed",bottom:"0px",width:"inherit"}},[e._l(e.engines,(function(t,i){return n("el-tag",{key:t.id,attrs:{type:t.id-1==e.selectId?"success":"info",hit:t.id-1==e.selectId,color:t.id-1==e.selectId?"":"Transparent"},on:{click:function(n){return e.search(t)}},nativeOn:{mouseenter:function(n){return e.selectSearch(t)}}},[t.icon?n("img",{staticStyle:{width:"30px",height:"30px"},attrs:{src:t.icon}}):e._e(),t.icon?e._e():n("span",[e._v(e._s(t.name))])])})),e.showHistoryDaysTooltip?n("span",[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",disabled:e.disabledHistoryTooltip,content:e.getMessage("historyDaysTip"),placement:"top"}},[n("el-slider",{staticStyle:{position:"absolute",right:"30px",width:"100px",top:"0px"},attrs:{"input-size":e.mini,max:365},on:{change:e.onChangeHistoryDays},model:{value:e.historyDays,callback:function(t){e.historyDays=t},expression:"historyDays"}})],1)],1):e._e(),n("i",{staticClass:"el-icon-setting",staticStyle:{cursor:"pointer",position:"absolute",top:"15px",right:"1px",opacity:"0.2"},on:{click:function(t){return e.setting()}}}),n("el-popover",{attrs:{trigger:"manual",placement:"bottom",width:"160"},model:{value:e.first,callback:function(t){e.first=t},expression:"first"}},[n("p",[e._v(e._s(e.getMessage("tabTip")))]),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.setFirst()}}},[e._v(e._s(e.getMessage("dontTip")))])],1)])],2)],1)}),a=[],c=(n("28a5"),n("4917"),n("6762"),n("2fdb"),n("ac6a"),n("5df3"),n("f400"),n("386d"),n("a481"),n("7f7f"),"63px"),l="300px",u="700px",h={name:"App",components:{},data:function(){return{tableheight:{height:c,width:l},engines:[],query:"",selectId:0,tabIndex:-1,first:!1,searchInNewTab:!0,queryMatchHistory:[],historyDays:90,showHistoryDaysTooltip:!1,disabledHistoryTooltip:!1,preHeight:c,highlightFirstItem:!1}},methods:{init:function(){var e=this,t={engines:chrome.i18n.getMessage("defaultEnginesConfig"),first:!0,selectId:0,searchInNewTab:!0},n=this;chrome.storage.sync.get(t,(function(e){n.engines=JSON.parse(e.engines);var t=0;n.engines=n.engines.filter((function(e){if(e.name&&e.url&&!0===e.inPopup)return t++,e.id=t,e})),n.first=e.first,n.selectId=e.selectId,n.searchInNewTab=e.searchInNewTab,console.log(n.engines),console.log(n.first),console.log("get with selectId "+n.selectId),n.selectId>=n.engines.length&&(n.selectId=0,console.log("change selectId to "+n.selectId))})),chrome.tabs.query({active:!0},(function(e){var t=e[0],i=g(t.url);n.query=i["wd"]||i["word"]||i["q"]||i["query"]||i["w"]||"",n.query=decodeURI(n.query),n.tabIndex=t.index})),this.$nextTick((function(){e.$refs["queryInput"].focus()}))},getMessage:function(e){return chrome.i18n.getMessage(e)},search:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];chrome.storage.sync.set({selectId:this.selectId}),this.searchInNewTab&&(t=!t),this.query=this.query.trim(),this.query&&!t?(chrome.tabs.update({url:e.url.replace("%s",this.query)}),window.close()):this.query&&(chrome.tabs.create({url:e.url.replace("%s",this.query),index:this.tabIndex+1}),window.close())},selectSearch:function(e){this.selectId=e.id-1},onSubmit:function(){this.searchFirst(!1)},searchFirst:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.search(this.engines[this.selectId],e)},changeSelectId:function(){this.selectId=(this.selectId+1)%this.engines.length},onKeyDown:function(e){return 9==e.keyCode&&(document.getElementsByClassName("el-autocomplete-suggestion")&&(document.getElementsByClassName("el-autocomplete-suggestion")[0].style.display="block"),e.preventDefault(),this.changeSelectId(),!1)},setting:function(){var e=chrome.runtime.getURL("options.html");chrome.tabs.create({url:e})},setFirst:function(){this.first=!1,chrome.storage.sync.set({first:!1})},unique:function(e,t){var n=new Map;return e.filter((function(e){return!n.has(e[t])&&n.set(e[t],1)}))},getHeight:function(e){return 0==e?63:1==e?132:Math.min(360,90+34*e)},googleSuggest:function(e,t){try{this.$axios.get("https://suggestqueries.google.com/complete/search?client=youtube&q=".concat(e,"&jsonp=window.google.ac.h")).then((function(e){if(200==e.status){var n=JSON.parse(e.data.replace(/window.google.ac.h\((.*)\)/,"$1")),i=n[1].map((function(e){return{value:e[0]}}));i=i.slice(0,5).concat(that.queryMatchHistory).concat(i.slice(5)),that.tableheight.height=that.getHeight(i.length)+"px",t(i)}}),(function(){console.log("request suggestqueries.google.com failed")}))}catch(n){console.log(n)}},bingSuggest:function(e,t){var n=this;this.highlightFirstItem=!1;try{this.$axios.get("https://api.bing.com/qsonhs.aspx?type=cb&q=".concat(e,"&cb=window.bing.sug")).then((function(e){if(200==e.status){var i=JSON.parse(e.data.replace(/.*window.bing.sug\((.*)\/\* pageview_candidate \*\/\)\;/,"$1"));if(i["AS"]["FullResults"]<=0)return;var o=i.AS.Results.flatMap((function(e){return e.Suggests.map((function(e){return{value:e.Txt}}))})),s=n.queryMatchHistory.filter((function(e){return e.pin})).concat(n.queryMatchHistory.filter((function(e){return e.visitCount&&e.visitCount>=3}))).slice(0,1),r=s.map((function(e){return e.url}));s&&(n.highlightFirstItem=!0);var a=n.queryMatchHistory.filter((function(e){return!r.includes(e.url)}));o=s.concat(o.slice(0,5)).concat(a).concat(o.slice(5)),n.tableheight.height=n.getHeight(o.length)+"px",t(o)}}),(function(){console.log("request api.bing.com failed")}))}catch(i){console.log(i)}},queryMatch:function(e,t){this.tableheight.width=u,this.showHistoryDaysTooltip=!0;var n=this,i=[];this.queryMatchHistory=[],console.log("query match start: "+e+" history days: "+this.historyDays),this.bingSuggest(e,t),chrome.bookmarks.search(e,(function(e){i=e.filter((function(e){return null!=e["url"]})).slice(0,10)}));var o=e.match(/^[^-]+/),s=e.match(/(?<=-)\w+/g);e=o[0],chrome.history.search({text:e,maxResults:30,startTime:(new Date).getTime()-864e5*n.historyDays},(function(o){console.log("bookmarks"),console.log(i),console.log("history:"),console.log(o),o=n.unique(i.concat(o),"url"),o.forEach((function(t){var n=t["url"].replace(/^https?:\/\/(www\.)?/,"");t["value"]="".concat(t["title"],' - <span style="color:blue;">').concat(n,"</span>"),t.dateAdded&&(t["value"]="⭐️".concat(t["value"])),e.split(/[\s\+]+/).forEach((function(e){e=e.trim(),e&&(t["value"]=t["value"].replaceAll(e,"<b>".concat(e,"</b>")))}));var i=new URL(t["url"]).hostname;t.visitCount&&0===i.indexOf(e)&&(t["pin"]=!0),-1!=t["url"].indexOf("http")&&(t["value"]='<img src="https://icon.horse/icon/'.concat(i,'" style="width: 18px; vertical-align: middle;"> ').concat(t["value"]))})),s&&s.length>0&&s.forEach((function(e){e=e.trim().toLowerCase(),e&&(o=o.filter((function(t){return-1==t["url"].toLowerCase().indexOf(e)&&-1==t["title"].toLowerCase().indexOf(e)})))})),n.queryMatchHistory=o,n.tableheight.height=n.getHeight(o.length)+"px",t(o)}))},handleSelect:function(e){console.log(e),e.url?this.searchInNewTab?(chrome.tabs.create({url:e.url,index:this.tabIndex+1}),window.close()):(chrome.tabs.update({url:e.url}),window.close()):this.searchFirst()},handleBlur:function(e){console.log("blur")},handleFocus:function(e){console.log("focus"),e.target.select()},onChangeHistoryDays:function(){this.disabledHistoryTooltip=!0,document.getElementsByClassName("el-autocomplete-suggestion")&&(document.getElementsByClassName("el-autocomplete-suggestion")[0].style.display="block")}},created:function(){this.init(),window.addEventListener("keydown",this.onKeyDown)},beforeDestroy:function(){window.removeEventListener("keydown",this.onKeyDown)},computed:{},watch:{query:function(e){""==e&&(this.tableheight.height=c)}},mounted:function(){}};function g(e){var t={},n=/([^?=&]+)=([^?=&]+)/g;return e=e.replace(/#.*/,""),e.replace(n,(function(){t[arguments[1]]=arguments[2]})),t}var f=h,d=n("2877"),p=Object(d["a"])(f,r,a,!1,null,null,null),y=p.exports,m=n("bc3a"),b=n.n(m);i["default"].use(s.a),i["default"].prototype.$axios=b.a,new i["default"]({el:"#app",render:function(e){return e(y)}})}});